!function(d){"use strict";var t=d("#woocommerce-order-items"),s=(moment(),moment().add("2","months"),wp.template("loftocean-room-extra-services"));function o(){t.unblock()}function m(e){var t=d(e).closest(".edit-cs-room-order-item");return t.data("utils")||(e=new loftoceanRoomReservationUtils(t.data("reservation-data")?JSON.parse(Base64.decode(t.data("reservation-data"))):{}),t.data("utils",e)),t.data("utils")}d(document).ready(function(){t.on("click",".loftocean-room-product-row .cs_check_in_date_field input[type=text]",function(e){var o;e.preventDefault(),d(this).data("date-picker-inited")||(o=d(this)).datepicker({dateFormat:"yy-mm-dd",minDate:0,beforeShowDay:function(e){e=e,e=m(o).showCheckinDates(moment(e));return e[0]&&(e[1].includes("checkin")||e[1].includes("disabled"))&&(e[1]+=" ui-datepicker-unselectable ui-state-disabled"),e},onSelect:function(e,t){o.closest(".form-field-wrapper").find(".cs_check_out_date_field input[type=text]").val(""),o.trigger("change")}}).datepicker("show").data("date-picker-inited",!0)}).on("click",".loftocean-room-product-row .cs_check_out_date_field input[type=text]",function(e){e.preventDefault();var c=d(this);c.data("date-picker-inited")||c.datepicker({dateFormat:"yy-mm-dd",minDate:1,beforeShowDay:function(e){var t,e=(t=e,m(e=c).showCheckoutDates(moment(t),moment(d(e).closest(".form-field-wrapper").find(".cs_check_in_date_field input[type=text]").val())));return e[0]&&(e[1].includes("checkout")||e[1].includes("disabled"))&&(e[1]+=" ui-datepicker-unselectable ui-state-disabled"),e},onSelect:function(e,t){var o,a=m(c),i=c.closest(".form-field-wrapper"),d=i.find(".cs_check_in_date_field input[type=text]").val(),r=i.siblings(".room-details-fields").find(".description.room-description"),n=a.getEnabledExtraServiceList(d,e);!1!==n&&((i=c.closest(".edit-cs-room-order-item")).find(".cs_extra_services_field").remove(),Array.isArray(n)&&n.length&&i.append(s({itemID:c.closest(".loftocean-room-product-row").data("order_item_id"),services:n,selectedServices:a.data.selectedServices}))),r.length&&(!d||!e||!1===(o=a.getRoomLimitation(d,e))?r.hide():r.find(".max-room-number").text(o).show()),c.trigger("change")}}).datepicker("show").data("date-picker-inited",!0),c.val()||(!(e=c.closest(".form-field-wrapper").find(".cs_check_in_date_field input[type=text]").val())||(e=moment(e)).isValid()&&c.datepicker("setDate",e.add("1","day").format("YYYY-MM-DD")).val(""))}).on("click",".button.add-order-room-item",function(){return d(this).WCBackboneModal({template:"wc-modal-add-room"}),!1}).on("change keyup","input",function(e){d(this).closest(".edit-cs-room-order-item").find(".room-order-item-status").val("updated")});var i={init:function(e,t){"wc-modal-add-room"===t&&d(document.body).trigger("wc-enhanced-select-init")},response:function(e,t,o){if("wc-modal-add-room"===t){var t=d(this).find("table.widefat").find("tbody").find("tr"),a=[];return d(t).each(function(){a.push({id:d(this).find(':input[name="item_id"]').val()})}),i.add_items(a)}},add_items:function(e){t.block({message:null,overlayCSS:{background:"#fff",opacity:.6}});e={action:"loftocean_add_order_room_item",order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce,data:e};"true"===d("button.cancel-action").attr("data-reload")&&(e.items=d("table.woocommerce_order_items :input[name], .wc-order-totals-items :input[name]").serialize()),e=this.filter_data("add_items",e),d.ajax({type:"POST",url:woocommerce_admin_meta_boxes.ajax_url,data:e,success:function(e){e.success?(d("#woocommerce-order-items").find(".inside").empty(),d("#woocommerce-order-items").find(".inside").append(e.data.html),e.data.notes_html&&(d("ul.order_notes").empty(),d("ul.order_notes").append(d(e.data.notes_html).find("li"))),o()):(o(),window.alert(e.data.error))},complete:function(){window.wcTracks.recordEvent("order_edit_add_room",{order_id:woocommerce_admin_meta_boxes.post_id,status:d("#order_status").val()})},dataType:"json"})},filter_data:function(e,t){var o=d("#woocommerce-order-items").triggerHandler("woocommerce_order_meta_box_${handle}_ajax_data",[t]);return o||t}};d(document.body).on("wc_backbone_modal_loaded",i.init).on("wc_backbone_modal_response",i.response)})}(jQuery);